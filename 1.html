<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Smartphone Hidden Camera Detector</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        background: radial-gradient(circle, #0f2027, #203a43, #2c5364);
        color: #00fff5;
        text-align: center;
        padding: 20px;
        font-family: 'Poppins', sans-serif;
    }
    h1 {
        font-size: 2rem;
        color: #00f0ff;
        margin-bottom: 20px;
        text-shadow: 0 0 10px #00fff5, 0 0 20px #00fff5;
    }
    #video {
        border: 3px solid #00fff5;
        border-radius: 15px;
        box-shadow: 0 0 20px #00fff5;
        max-width: 100%;
    }
    #strengthBar {
        width: 80%;
        height: 25px;
        margin-top: 20px;
        accent-color: #00fff5;
    }
    .alert-text {
        font-size: 1.2rem;
        color: #ff004c;
        margin-top: 15px;
        padding: 15px;
        background: rgba(255,0,76,0.15);
        border: 2px solid #ff004c;
        border-radius: 10px;
        text-shadow: 0 0 10px #ff004c;
        display: none;
        animation: blink 0.8s infinite alternate;
    }
    @keyframes blink { from {opacity:1;} to{opacity:0.5;} }
    .slider-and-button { margin-top: 20px; color: #00fff5; }
    input[type=range] { width: 60%; accent-color: #00fff5; }
    .neon-btn { display:inline-block; padding:12px 20px; color:#00fff5; font-size:1rem; border:2px solid #00fff5; border-radius:10px; background:transparent; margin:10px; transition:0.3s; }
    .neon-btn:hover { background:#00fff5; color:#000; box-shadow:0 0 15px #00fff5; }
    #map {
        height: 300px;
        width: 100%;
        border: 1px solid #00fff5;
        border-radius: 10px;
        margin: 20px 0;
        display: none;
    }
    .location-info {
        margin: 15px 0;
        padding: 15px;
        background: rgba(0, 255, 245, 0.1);
        border: 1px solid #00fff5;
        border-radius: 10px;
        color: #00fff5;
    }
</style>
</head>
<body>
<h1>üö® Smartphone Hidden Camera Detector</h1>

<video id="video" width="100%" height="auto" autoplay playsinline></video>
<canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

<progress id="strengthBar" value="0" max="100"></progress>
<div class="alert-text" id="alertText">‚ö†Ô∏è Potential Hidden Camera Detected!</div>

<div class="slider-and-button">
    <label>Sensitivity (Threshold): <span id="thresholdValue">240</span></label><br>
    <input type="range" id="thresholdRange" min="200" max="255" value="240">
</div>

<div class="button-group">
    <button class="neon-btn" id="startButton">Start Detection üîä</button>
    <button class="neon-btn" id="switchButton">Switch Camera üîÑ</button>
    <button class="neon-btn" id="shareLocationBtn">Share Location üìç</button>
    <button class="neon-btn" id="showMapBtn">Show Map üó∫Ô∏è</button>
</div>

<div id="map"></div>

<div class="location-info">
    <h3>Live Location</h3>
    <div id="locationStatus">Click "Share Location" to start tracking</div>
    <div id="coordinates"></div>
    <div id="accuracy"></div>
    <div id="lastUpdate"></div>
</div>

<!-- Add Leaflet CSS and JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// DOM Elements
let video = document.getElementById("video");
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let strengthBar = document.getElementById("strengthBar");
let alertText = document.getElementById("alertText");
let thresholdRange = document.getElementById("thresholdRange");
let thresholdValue = document.getElementById("thresholdValue");
let startButton = document.getElementById("startButton");
let switchButton = document.getElementById("switchButton");
let shareLocationBtn = document.getElementById("shareLocationBtn");
let showMapBtn = document.getElementById("showMapBtn");
let mapDiv = document.getElementById("map");
let locationStatus = document.getElementById("locationStatus");
let coordinatesDiv = document.getElementById("coordinates");
let accuracyDiv = document.getElementById("accuracy");
let lastUpdateDiv = document.getElementById("lastUpdate");

// App state
let map;
let watchId = null;
let currentMarker = null;
let currentPosition = null;

let threshold = parseInt(thresholdRange.value);
let audioCtx, osc, gainNode;
let consecutiveCount = 0;
let currentStream;
let useRearCamera = true; // default to rear camera

thresholdRange.addEventListener("input", () => {
    threshold = parseInt(thresholdRange.value);
    thresholdValue.textContent = threshold;
});

// Function to initialize camera (front/rear)
async function initCamera() {
    if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
    }
    const constraints = {
        video: {
            facingMode: useRearCamera ? { exact: "environment" } : "user",
            width: { ideal: 1280 },
            height: { ideal: 720 }
        },
        audio: false
    };
    try {
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = currentStream;
        await video.play();
    } catch (err) {
        alert("Camera access error: " + err.message);
    }
}

// Switch camera button
switchButton.addEventListener("click", () => {
    useRearCamera = !useRearCamera;
    initCamera();
});

// Start detection
startButton.addEventListener("click", () => {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    osc = audioCtx.createOscillator();
    gainNode = audioCtx.createGain();
    osc.connect(gainNode).connect(audioCtx.destination);
    osc.type = "sine";
    osc.frequency.value = 0;
    gainNode.gain.value = 0;
    osc.start();

    detectLoop();
    startButton.disabled = true;
});

// Detection loop
function detectLoop() {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
    let brightSpots = 0;

    // Check central 200x200 area
    const startX = canvas.width / 2 - 100;
    const startY = canvas.height / 2 - 100;
    for (let y = startY; y < startY + 200; y += 5) {
        for (let x = startX; x < startX + 200; x += 5) {
            const i = (y * canvas.width + x) * 4;
            const b = (frame.data[i] + frame.data[i+1] + frame.data[i+2]) / 3;
            if (b > threshold) brightSpots++;
        }
    }

    const strength = Math.min(brightSpots, 200);
    strengthBar.value = (strength / 200) * 100;

    if (strength > 5) consecutiveCount++;
    else consecutiveCount = 0;

    if (consecutiveCount >= 5) {
        alertText.style.display = "block";
        osc.frequency.value = 300 + strength * 2;
        gainNode.gain.value = 0.3;
    } else {
        alertText.style.display = "none";
        osc.frequency.value = 0;
        gainNode.gain.value = 0;
    }

    requestAnimationFrame(detectLoop);
}

// Initialize map
function initMap(lat = 20.5937, lng = 78.9629) { // Default to India center
    if (map) {
        map.remove();
    }
    
    map = L.map('map').setView([lat, lng], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);
    
    if (currentPosition) {
        const { latitude, longitude } = currentPosition.coords;
        if (currentMarker) {
            map.removeLayer(currentMarker);
        }
        currentMarker = L.marker([latitude, longitude]).addTo(map);
        map.setView([latitude, longitude], 15);
    }
}

// Get current location
function getCurrentLocation() {
    if (navigator.geolocation) {
        locationStatus.textContent = 'Getting location...';
        navigator.geolocation.getCurrentPosition(
            position => updateLocation(position),
            error => handleLocationError(error),
            { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
    } else {
        locationStatus.textContent = 'Geolocation is not supported by your browser';
    }
}

// Watch position
function startWatchingPosition() {
    if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
    }
    
    watchId = navigator.geolocation.watchPosition(
        position => updateLocation(position),
        error => handleLocationError(error),
        { 
            enableHighAccuracy: true, 
            timeout: 5000, 
            maximumAge: 0 
        }
    );
    
    shareLocationBtn.textContent = 'Stop Sharing';
    shareLocationBtn.classList.add('sharing-active');
}

// Stop watching position
function stopWatchingPosition() {
    if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
        watchId = null;
    }
    shareLocationBtn.textContent = 'Share Location';
    shareLocationBtn.classList.remove('sharing-active');
}

// Update location display
function updateLocation(position) {
    currentPosition = position;
    const { latitude, longitude, accuracy } = position.coords;
    const timestamp = new Date(position.timestamp).toLocaleTimeString();
    
    // Update location info
    coordinatesDiv.textContent = `Latitude: ${latitude.toFixed(6)}, Longitude: ${longitude.toFixed(6)}`;
    accuracyDiv.textContent = `Accuracy: ${Math.round(accuracy)} meters`;
    lastUpdateDiv.textContent = `Last updated: ${timestamp}`;
    locationStatus.textContent = 'Location tracking active';
    
    // Update map if visible
    if (map) {
        if (currentMarker) {
            map.removeLayer(currentMarker);
        }
        currentMarker = L.marker([latitude, longitude]).addTo(map);
        map.setView([latitude, longitude]);
        
        // Add accuracy circle
        L.circle([latitude, longitude], {
            color: '#00fff5',
            fillColor: '#00fff5',
            fillOpacity: 0.1,
            radius: accuracy
        }).addTo(map);
    }
}

// Handle location errors
function handleLocationError(error) {
    let message = 'Error getting location: ';
    switch(error.code) {
        case error.PERMISSION_DENIED:
            message += 'User denied the request for geolocation.';
            break;
        case error.POSITION_UNAVAILABLE:
            message += 'Location information is unavailable.';
            break;
        case error.TIMEOUT:
            message += 'The request to get user location timed out.';
            break;
        case error.UNKNOWN_ERROR:
            message += 'An unknown error occurred.';
            break;
    }
    locationStatus.textContent = message;
}

// Share location via Web Share API
async function shareLocation() {
    if (!currentPosition) {
        alert('No location data available. Please enable location sharing first.');
        return;
    }
    
    const { latitude, longitude } = currentPosition.coords;
    const mapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
    const shareData = {
        title: 'My Current Location',
        text: `I'm at ${latitude}, ${longitude}`,
        url: mapsUrl
    };
    
    try {
        await navigator.share(shareData);
    } catch (err) {
        // Fallback for browsers that don't support Web Share API
        navigator.clipboard.writeText(mapsUrl);
        alert('Link copied to clipboard!');
    }
}

// Event Listeners
shareLocationBtn.addEventListener('click', () => {
    if (watchId === null) {
        getCurrentLocation();
        startWatchingPosition();
    } else {
        stopWatchingPosition();
    }
});

showMapBtn.addEventListener('click', () => {
    if (mapDiv.style.display === 'none' || !mapDiv.style.display) {
        mapDiv.style.display = 'block';
        showMapBtn.textContent = 'Hide Map üó∫Ô∏è';
        if (currentPosition) {
            const { latitude, longitude } = currentPosition.coords;
            initMap(latitude, longitude);
        } else {
            initMap();
        }
    } else {
        mapDiv.style.display = 'none';
        showMapBtn.textContent = 'Show Map üó∫Ô∏è';
    }
});

// Initialize rear camera on load
window.addEventListener('load', () => {
    initCamera();
    // Initialize map with default view (hidden)
    initMap();
    mapDiv.style.display = 'none';
});
</script>
</body>
</html>